services:
  dockdash:
    build: .
    container_name: dockdash
    ports:
      - "${DOCKDASH_PORT:-9999}:5000"
    volumes:
      # Mount Docker socket (or Podman socket for rootless: /run/user/1000/podman/podman.sock)
      - /var/run/docker.sock:/var/run/docker.sock:rw
      # Use bind mount for data directory (more reliable than named volumes)
      - ./data:/app/data
    environment:
      - SECRET_KEY=${SECRET_KEY:-change-me-in-production}
      - DEFAULT_USERNAME=${DEFAULT_USERNAME:-admin}
      - DEFAULT_PASSWORD=${DEFAULT_PASSWORD:-dockdash}
      - DOCKDASH_PORT=${DOCKDASH_PORT:-9999}
      # Set HOST_IP to your server's LAN IP for correct container URLs
      - HOST_IP=${HOST_IP:-}
      # Session configuration
      - SESSION_LIFETIME_HOURS=${SESSION_LIFETIME_HOURS:-12}
      - SESSION_COOKIE_SECURE=${SESSION_COOKIE_SECURE:-0}
      # Auto-start background monitoring
      - AUTO_START_MONITORING=${AUTO_START_MONITORING:-0}
    # Run as root to access Docker socket (or use group_add for non-root)
    user: root
    restart: unless-stopped
    # Health check
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:5000/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s

